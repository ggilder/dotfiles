#!/usr/bin/env bash

set -euo pipefail

# Delete regular merges
git branch --merged master | cut -b 3- | (grep --invert-match '^master$' || echo) | xargs git branch -d

# Delete squash-and-merges by figuring out branches that would apply no diff to master if merged
git for-each-ref refs/heads/ "--format=%(refname:short)" | while read -r branch; do
[[ "$branch" == "master" ]] && continue
([ -z "$(git merge-tree "$(git merge-base master "$branch")" master "$branch")" ] && git branch -D "$branch") || true
done
